pico-8 cartridge // http://www.pico-8.com
version 42
__lua__

function _init()
    pal(0, 129, 1)

    debug={}
    stars={}

    for i=1,70 do
        local star_type = rnd({
            star,
            near_star,
            far_star
        })
        add(stars, star_type:new({
            x = rnd(128),
            y = rnd(128),
            radius = star_type.radius + rnd(0.3),
            speed = star_type.speed + rnd(0.3)
        }))
    end

    ship = space_ship:new({
        x = 64,
        y = 90
    })
end

function _update60()
    for s in all(stars) do
        s:update()
    end

    ship:update()
end

function _draw()
    cls()

    for s in all(stars) do
        s:draw()
    end

    ship:draw()

    for i,d in ipairs(debug) do
        print(d, 4, i * 6, 8)
    end
end
-->8
-- common

class = {}

function class:new(props)
    local instance = props or {}
    setmetatable(instance, {
        __index = self
    })
    return instance
end

function class:extend(props)
    return self:new(props)
end

entity = class:extend({
    x = 0,
    y = 0
})

-->8
-- star

star = entity:extend({
    colour = 13,
    speed = 0.5,
    radius = 0,
})

function star:update()
    self.y += self.speed
    if (self:is_offscreen()) then
        self:reset()
    end
end

function star:is_offscreen()
    return self.y - self.radius >= 128
end

function star:reset()
    self.y = -self.radius
    self.x = rnd(128)
end

function star:draw()
    circfill(
        self.x,
        self.y,
        self.radius,
        self.colour
    )
end

near_star = star:extend({
    colour = 7,
    speed = 0.75,
    radius = 1.2,
})

far_star = star:extend({
    colour = 1,
    speed = 0.25,
    radius = 0.3,
})
-->8
-- space ship

space_ship = entity:extend({
    bullets = {},
    weapon = -1,
    fire_rate = 5,
    guns_cooldown = 0
})

function space_ship:update()
    self.guns_cooldown -= 1

    if (btn(⬅️)) self.x -= 1
    if (btn(➡️)) self.x += 1
    if (btn(❎)) self:fire()

    self.x = max(16, min(self.x, 128 - 16))

    for b in all(self.bullets) do
        b:update()
        if (b:is_offscreen()) del(self.bullets, b)
    end
end

function space_ship:fire()
    if (self.guns_cooldown > 0) return

    add(self.bullets, bullet:new({
        x = self.x + (10.5 * self.weapon),
        y = self.y + 7,
    }))

    self.weapon *= -1
    self.guns_cooldown = self.fire_rate
end

function space_ship:draw()
    spr(1, self.x - 16, self.y, 4, 4)

    for b in all(self.bullets) do
        b:draw()
    end
end

bullet = entity:extend({
    speed = 1.6
})

function bullet:is_offscreen()
    return self.y <= 0
end

function bullet:update()
    self.y -= self.speed
end

function bullet:draw()
    circfill(self.x, self.y, 1, 10)
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000005555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000055555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000555dd5550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000055dddd550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000055dddd550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000005555000555dddd555000555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000005555555555d7777d55555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000005577555555d7777d55555577550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000557755666dddddddd6665577550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000055776666ddd7777ddd666677550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000005555dd66666dd7777dd66666dd555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000055566dd6666ddd7777ddd6666dd665550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000055d666666666dddddddd666666666d550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000055666666666dddddddddd666666666550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000005566ddddd666ddd77ddd666ddddd66550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000005566d666d66dddd77dddd66d666d66550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000005566d666d666ddd77ddd666d666d66550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000005566d666d66dddd66dddd66d666d66550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555556665555577667755555666555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000055556665555555665555555666555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000555555500555665550055555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000055555000055dd5500005555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000055555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000005555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
