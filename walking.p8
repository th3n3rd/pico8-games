pico-8 cartridge // http://www.pico-8.com
version 42
__lua__

function _init()
    debug = {}
end

function _update60()
    player:update()
end

function _draw()
    cls(0)
    player:draw()

    for i,d in ipairs(debug) do
        print(d, 4, i * 6, 8)
    end
end
-->8
-- common

class = {}

function class:new(props)
    local instance = props or {}
    setmetatable(instance, {
        __index = self
    })
    return instance
end

function class:extend(props)
    return self:new(props)
end

entity = class:extend({
    x = 0,
    y = 0,
})
-->8
-- player

player = entity:extend({
    state = "idle",
    step = 0,
    animation = {
        step = 0,
        frame_rate = 10,
        cooldown = 0,
    },
})

function player:update()
    self.state = "idle"

    -- the order of the button is important!

    if (btn(⬆️)) then
        self.state = "walking"
        self.sprite = 49
        self.y -= 1
    end

    if (btn(⬇️)) then
        self.state = "walking"
        self.sprite = 33
        self.y += 1
    end

    if (btn(⬅️)) then
        self.state = "walking"
        self.sprite = 17
        self.x -= 1
    end

    if (btn(➡️)) then
        self.state = "walking"
        self.sprite = 1
        self.x += 1
    end

    if (self.state == "walking") then
        self.animation.step += 0.05
        self.animation.step %= 6
--	 if (self.animation.cooldown <= 0) then
--			self.animation.step = 1 + (self.animation.step + 1) % 5
--			self.animation.cooldown = self.animation.frame_rate
--		end
    end

    if (self.state == "idle") then
        self.sprite = 33
        self.animation.step = 0
    end

    self.animation.cooldown -= 1
end

function player:draw()
    ovalfill(self.x + 1, self.y + 8, self.x + 6, self.y + 8, 6)
    spr(self.sprite + self.animation.step, self.x, self.y)
end
__gfx__
00000000007777000077770000777700007777000077770000777700000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777700777777007777770077777700777777007777770000000000000000000000000000000000000000000000000000000000000000000000000
00000000077707000777070007770700077707000777070007770700000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777700777777007777770077777700777777007777770000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777700777777007777770077777700777777007777770000000000000000000000000000000000000000000000000000000000000000000000000
00000000006777600067776000677760006777600067776000677760000000000000000000000000000000000000000000000000000000000000000000000000
00000000007006000006700000007000000760000000700000067000000000000000000000000000000000000000000000000000000000000000000000000000
00000000005002000020050000005000005002000000500000200500000000000000000000000000000000000000000000000000000000000000000000000000
00000000007777000077770000777700007777000077770000777700000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777700777777007777770077777700777777007777770000000000000000000000000000000000000000000000000000000000000000000000000
00000000007077700070777000707770007077700070777000707770000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777700777777007777770077777700777777007777770000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777700777777007777770077777700777777007777770000000000000000000000000000000000000000000000000000000000000000000000000
00000000067776000677760006777600067776000677760006777600000000000000000000000000000000000000000000000000000000000000000000000000
00000000006007000007600000070000000670000007000000076000000000000000000000000000000000000000000000000000000000000000000000000000
00000000002005000050020000050000002005000005000000500200000000000000000000000000000000000000000000000000000000000000000000000000
00000000007777000077770000777700007777000077770000777700000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777700777777007777770077777700777777007777770000000000000000000000000000000000000000000000000000000000000000000000000
00000000070770700707707007077070070770700707707007077070000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777700777777007777770077777700777777007777770000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777700777777007777770077777700777777007777770000000000000000000000000000000000000000000000000000000000000000000000000
00000000067777600677776006777760067777600677776006777760000000000000000000000000000000000000000000000000000000000000000000000000
00000000006006000070060000600700007006000060070000700600000000000000000000000000000000000000000000000000000000000000000000000000
00000000002002000050000000000500005000000000050000500000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007777000077770000777700007777000077770000777700000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777700777777007777770077777700777777007777770000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777700777777007777770077777700777777007777770000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777700777777007777770077777700777777007777770000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777700777777007777770077777700777777007777770000000000000000000000000000000000000000000000000000000000000000000000000
00000000067777600677776006777760067777600677776006777760000000000000000000000000000000000000000000000000000000000000000000000000
00000000007007000070060000600700007006000060070000700600000000000000000000000000000000000000000000000000000000000000000000000000
00000000005005000050000000000500005000000000050000500000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000004142434400000000000000000000000041424344000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
